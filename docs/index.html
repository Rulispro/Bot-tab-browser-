<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Multi Akun Facebook - Simpan Cookies</title>
</head>
<body>
  <h2>Facebook Multi-Akun</h2>

  <label for="accountName">Nama Akun:</label><br>
  <input type="text" id="accountName" placeholder="Contoh: FB Utama"><br><br>

  <label for="cookieInput">Tempel Cookies (dari ekstensi):</label><br>
  <textarea id="cookieInput" rows="6" cols="50" placeholder="Paste cookies di sini..."></textarea><br><br>

  <button onclick="simpanCookies()">üíæ Simpan Cookies</button>
  <button onclick="pakaiCookies()">üç™ Pakai Cookies</button>
  <button onclick="hapusSemua()">üóë Hapus Semua Akun</button>

  <h3>Pilih Akun Tersimpan:</h3>
  <select id="akunDropdown">
    <option disabled selected>Memuat akun...</option>
  </select>

  <script>
    const dbName = 'facebook-multiaccount';
    const storeName = 'cookies';

    function convertStringToCookies(cookieStr) {
      return cookieStr.split(";").map(pair => {
        const [name, value] = pair.split("=").map(s => s.trim());
        return {
          name,
          value,
          domain: ".facebook.com",
          path: "/"
        };
      });
    }

    function saveCookies(name, cookies) {
      const open = indexedDB.open(dbName, 1);

      open.onupgradeneeded = function () {
        const db = open.result;
        if (!db.objectStoreNames.contains(storeName)) {
          db.createObjectStore(storeName, { keyPath: "name" });
        }
      };

      open.onsuccess = function () {
        const db = open.result;
        const tx = db.transaction(storeName, "readwrite");
        const store = tx.objectStore(storeName);
        store.put({ name, cookies });

        tx.oncomplete = () => {
          db.close();
          alert("Cookies berhasil disimpan!");
          tampilkanDropdown();
        };
      };
    }

    function tampilkanDropdown() {
      const open = indexedDB.open(dbName, 1);
      open.onsuccess = function () {
        const db = open.result;
        const tx = db.transaction(storeName, "readonly");
        const store = tx.objectStore(storeName);
        const req = store.getAll();

        req.onsuccess = function () {
          const dropdown = document.getElementById("akunDropdown");
          dropdown.innerHTML = "";

          if (req.result.length === 0) {
            dropdown.innerHTML = `<option disabled selected>Tidak ada akun tersimpan</option>`;
            return;
          }

          req.result.forEach(item => {
            const option = document.createElement("option");
            option.value = item.name;
            option.innerText = item.name;
            dropdown.appendChild(option);
          });
        };
      };
    }

    function pakaiCookies() {
      const name = document.getElementById("akunDropdown").value;
      const open = indexedDB.open(dbName, 1);

      open.onsuccess = function () {
        const db = open.result;
        const tx = db.transaction(storeName, "readonly");
        const store = tx.objectStore(storeName);
        const req = store.get(name);

        req.onsuccess = function () {
          const data = req.result;
          if (!data) return alert("Cookies tidak ditemukan!");
          try {
            data.cookies.forEach(cookie => {
              document.cookie = `${cookie.name}=${cookie.value}; domain=${cookie.domain}; path=${cookie.path || "/"}`;
            });
            alert("Cookies berhasil di-inject!\nSilakan reload tab Facebook.");
          } catch (e) {
            alert("Gagal meng-inject cookies!");
          }
        };
      };
    }

    function hapusSemua() {
      if (!confirm("Yakin ingin menghapus semua akun?")) return;
      const open = indexedDB.open(dbName, 1);

      open.onsuccess = function () {
        const db = open.result;
        const tx = db.transaction(storeName, "readwrite");
        const store = tx.objectStore(storeName);
        const clearReq = store.clear();

        clearReq.onsuccess = function () {
          tampilkanDropdown();
          alert("Semua akun berhasil dihapus.");
        };
      };
    }

    function simpanCookies() {
      const accountName = document.getElementById('accountName').value.trim();
      const raw = document.getElementById('cookieInput').value.trim();

      if (!accountName || !raw) return alert("Isi semua kolom terlebih dahulu.");

      let cookies;
      try {
        cookies = JSON.parse(raw);
      } catch (e) {
        try {
          cookies = convertStringToCookies(raw);
        } catch (err) {
          return alert("Format cookies tidak dikenali.");
        }
      }

      saveCookies(accountName, cookies);
    }

    // Jalankan saat halaman dimuat
    window.onload = tampilkanDropdown;
  </script>
</body>
</html>
